!function(a){'function'==typeof define&&define.amd?define(['jquery'],a):a(window.jQuery||window.Zepto||window.$)}(function(a){var b=function(){for(var c,d,e,f=0,g=arguments.length;f<g;f++)b.isJquery(arguments[f])||b.isZepto(arguments[f])?c=arguments[f]:b.isElement(arguments[f])?c=a(arguments[f]):'function'==typeof arguments[f]?e=arguments[f]:'object'==typeof arguments[f]&&(d=arguments[f]);var h=new b.init(c,d);return'function'==typeof e&&e(h),h};b.isElement=function(a){return!(!a||'function'!=typeof HTMLElement&&'object'!=typeof HTMLElement||!(a instanceof HTMLElement))||!(!a||!a.nodeType||1!==a.nodeType)},b.isJquery=function(a){return!!(a&&a.length&&('function'==typeof jQuery||'object'==typeof jQuery)&&a instanceof jQuery)},b.isZepto=function(a){return!(!a||!a.length||'function'!=typeof Zepto&&'object'!=typeof Zepto||!Zepto.zepto.isZ(a))},b.getIndex=function(a,b){return b?a:a-1},b.getData=function(a,b){if('string'==typeof b&&b.length){b=b.split('.');for(var c=0,d=b.length;c<d;c++)a=a[b[c]]}return a},b.init=function(c,d){var e=this;if(b.isJquery(c)||b.isZepto(c)){var f={dom:{box:c}};e.attach=b.attach.bind(f),e.detach=b.detach.bind(f),e.setOptions=b.setOptions.bind(f),e.clear=b.clear.bind(f),f.changeEvent=function(){b.selectChange.call(f,this.className)},f.settings=a.extend({},a.cxSelect.defaults,d,{url:f.dom.box.data('url'),emptyStyle:f.dom.box.data('emptyStyle'),required:f.dom.box.data('required'),firstTitle:f.dom.box.data('firstTitle'),firstValue:f.dom.box.data('firstValue'),jsonSpace:f.dom.box.data('jsonSpace'),jsonName:f.dom.box.data('jsonName'),jsonValue:f.dom.box.data('jsonValue'),jsonSub:f.dom.box.data('jsonSub')});var g=f.dom.box.data('selects');'string'==typeof g&&g.length&&(f.settings.selects=g.split(',')),e.setOptions(),e.attach(),f.settings.url||f.settings.data?a.isArray(f.settings.data)?b.start.call(f,f.settings.data):'string'==typeof f.settings.url&&f.settings.url.length&&a.getJSON(f.settings.url,function(a){b.start.call(f,a)}):b.start.apply(f)}},b.setOptions=function(c){var d=this;if(c&&a.extend(d.settings,c),(!a.isArray(d.selectArray)||!d.selectArray.length||c&&c.selects)&&(d.selectArray=[],a.isArray(d.settings.selects)&&d.settings.selects.length))for(var e,f=0,g=d.settings.selects.length;f<g&&(e=d.dom.box.find('select.'+d.settings.selects[f]),e&&e.length);f++)d.selectArray.push(e);c&&(!a.isArray(c.data)&&'string'==typeof c.url&&c.url.length?a.getJSON(d.settings.url,function(a){b.start.call(d,a)}):b.start.call(d,c.data))},b.attach=function(){var a=this;a.attachStatus||a.dom.box.on('change','select',a.changeEvent),'boolean'==typeof a.attachStatus&&b.start.call(a),a.attachStatus=!0},b.detach=function(){var a=this;a.dom.box.off('change','select',a.changeEvent),a.attachStatus=!1},b.clear=function(a){var b=this,c={display:'',visibility:''};a=isNaN(a)?0:a;for(var d=a,e=b.selectArray.length;d<e;d++)b.selectArray[d].empty().prop('disabled',!0),'none'===b.settings.emptyStyle?c.display='none':'hidden'===b.settings.emptyStyle&&(c.visibility='hidden'),b.selectArray[d].css(c)},b.start=function(c){var d=this;if(a.isArray(c)&&(d.settings.data=b.getData(c,d.settings.jsonSpace)),d.selectArray.length){for(var e=0,f=d.selectArray.length;e<f;e++)'string'!=typeof d.selectArray[e].attr('data-value')&&d.selectArray[e][0].options.length&&d.selectArray[e].attr('data-value',d.selectArray[e].val());d.settings.data||'string'==typeof d.selectArray[0].data('url')&&d.selectArray[0].data('url').length?b.getOptionData.call(d,0):d.selectArray[0].prop('disabled',!1).css({display:'',visibility:''})}},b.getOptionData=function(c){var d=this;if(!('number'!=typeof c||isNaN(c)||c<0||c>=d.selectArray.length)){var e,f,g,h,i=c-1,j=d.selectArray[c],k=j.data('url'),l='undefined'==typeof j.data('jsonSpace')?d.settings.jsonSpace:j.data('jsonSpace'),m={};if(b.clear.call(d,c),'string'==typeof k&&k.length){if(i>=0){if(!d.selectArray[i].val().length)return;g=j.data('queryName'),h=d.selectArray[i].attr('name'),'string'==typeof g&&g.length?m[g]=d.selectArray[i].val():'string'==typeof h&&h.length&&(m[h]=d.selectArray[i].val())}a.getJSON(k,m,function(a){e=b.getData(a,l),b.buildOption.call(d,c,e)})}else if(d.settings.data&&'object'==typeof d.settings.data){e=d.settings.data;for(var n=0;n<c;n++){if(f=b.getIndex(d.selectArray[n][0].selectedIndex,'boolean'==typeof d.selectArray[n].data('required')?d.selectArray[n].data('required'):d.settings.required),'object'!=typeof e[f]||!a.isArray(e[f][d.settings.jsonSub])||!e[f][d.settings.jsonSub].length){e=null;break}e=e[f][d.settings.jsonSub]}b.buildOption.call(d,c,e)}}},b.buildOption=function(b,c){var d=this,e=d.selectArray[b],f='boolean'==typeof e.data('required')?e.data('required'):d.settings.required,g='undefined'==typeof e.data('firstTitle')?d.settings.firstTitle:e.data('firstTitle'),h='undefined'==typeof e.data('firstValue')?d.settings.firstValue:e.data('firstValue'),i='undefined'==typeof e.data('jsonName')?d.settings.jsonName:e.data('jsonName'),j='undefined'==typeof e.data('jsonValue')?d.settings.jsonValue:e.data('jsonValue');if(a.isArray(c)){var k=f?'':'<option value="'+String(h)+'">'+String(g)+'</option>';if('string'==typeof i&&i.length){'string'==typeof j&&j.length||(j=i);for(var l=0,m=c.length;l<m;l++)k+='<option value="'+String(c[l][j])+'">'+String(c[l][i])+'</option>'}else for(var l=0,m=c.length;l<m;l++)k+='<option value="'+String(c[l])+'">'+String(c[l])+'</option>';e.html(k).prop('disabled',!1).css({display:'',visibility:''}),'string'==typeof e.attr('data-value')&&(e.val(String(e.attr('data-value'))).removeAttr('data-value'),e[0].selectedIndex<0&&(e[0].options[0].selected=!0)),(f||e[0].selectedIndex>0)&&e.trigger('change')}},b.selectChange=function(a){var c=this;if('string'==typeof a&&a.length){var d;a=a.replace(/\s+/g,','),a=','+a+',';for(var e=0,f=c.selectArray.length;e<f;e++)if(a.indexOf(','+c.settings.selects[e]+',')>-1){d=e;break}'number'==typeof d&&d>-1&&(d+=1,b.getOptionData.call(c,d))}},a.cxSelect=function(){return b.apply(this,arguments)},a.cxSelect.defaults={selects:[],url:null,data:null,emptyStyle:null,required:!1,firstTitle:'请选择',firstValue:'',jsonSpace:'',jsonName:'n',jsonValue:'',jsonSub:'s'},a.fn.cxSelect=function(b,c){return this.each(function(d){a.cxSelect(this,b,c)}),this}});